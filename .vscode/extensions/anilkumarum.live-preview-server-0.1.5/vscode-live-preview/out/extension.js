var ae=Object.create;var F=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var ue=(e,r)=>{for(var o in r)F(e,o,{get:r[o],enumerable:!0})},Q=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of le(r))!de.call(e,a)&&a!==o&&F(e,a,{get:()=>r[a],enumerable:!(t=ce(r,a))||t.enumerable});return e};var h=(e,r,o)=>(o=e!=null?ae(me(e)):{},Q(r||!e||!e.__esModule?F(o,"default",{value:e,enumerable:!0}):o,e)),ve=e=>Q(F({},"__esModule",{value:!0}),e);var ye={};ue(ye,{activate:()=>Se,deactivate:()=>xe});module.exports=ve(ye);var i=require("vscode");var O=h(require("vscode")),m=O.workspace.getConfiguration("livePreviewServer.config"),I=O.workspace.getConfiguration("livePreviewServer.custom"),d={liveRefresh:m.get("liveRefresh"),customElementHMR:m.get("customElementHMR"),defaultBrowser:m.get("defaultBrowser"),statusBarCommand:m.get("statusBarCommand"),serverPort:m.get("serverPort"),baseDir:m.get("baseDir"),styleDir:m.get("styleDir"),compileTs:m.get("compileTs"),updateBrowserPath:m.get("updateBrowserPath"),toolTipBrowsers:m.get("toolTipBrowsers")},x={httpHeaders:I.get("httpHeaders"),quickPickBrowsers:I.get("quickPickBrowsers")};function N({affectsConfiguration:e}){if(e("livePreviewServer.config"))for(let t in d)d[t]=m.get(t);if(e("livePreviewServer.custom"))for(let t in x)x[t]=I.get(t)}var C=h(require("vscode"));var K=h(require("vscode")),z=require("node:fs/promises");function G(e){return{enableScripts:!0,localResourceRoots:[K.Uri.joinPath(e,"panel-bar")]}}function Y(){return{retainContextWhenHidden:!0,enableFindWidget:!0}}function J(e,r,o,t=3300){return`<!DOCTYPE html>
	<html lang="en">
	
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\u{1F3AF}</text></svg>">
		<title>Live html preview </title>
        <link rel="stylesheet" href="${r}">
	</head>

	
	<body>
        <style>
            body {
                padding: 0;
                background-color: #fff;
            }
        </style>
            
        <script type="module" src="${e}"></script>
        <address-bar port="${t}"></address-bar>
        <main>
            <iframe id="hostedContent" src="http://localhost:${t}${o}" frameborder="0"></iframe>
        </main>
        
	</body>
	
	</html>`}async function X(e){try{return(await(0,z.readdir)(e,{withFileTypes:!0})).map(t=>({name:t.name,isDirectory:t.isDirectory()}))}catch{return[]}}var Z=h(require("vscode"));var M=class{constructor(r,o,t){this.webview=r;this.cwd=o;this.console=t;r.onDidReceiveMessage(a=>this.handlers[a.command](a))}handlers={sendDirListing:async r=>{let o=await X(this.cwd+r.dirPath);this.webview.postMessage({type:"completionList",dirListings:o})},openDevTools(){Z.commands.executeCommand("workbench.action.webview.openDeveloperTools")},console:r=>{this.console.write(r.type,r.args)}}};var _=h(require("vscode")),ee=(s=>(s[s.trace=1]="trace",s[s.debug=2]="debug",s[s.info=3]="info",s[s.warn=4]="warn",s[s.error=5]="error",s))(ee||{}),pe=5,b=class{#e;constructor(){}create(r){this.#e=_.window.createOutputChannel(r,"javascript")}write(r,o){ee[r]>=pe&&this.#e.show(),this.#e.appendLine(`[${new Date().toLocaleTimeString()}] ${r} ${o}`)}log(r){this.#e?.appendLine(r)}dispose(){this.#e.dispose(),this.#e=null}};var E=class e{static currentPanel;static closePreview;static console;constructor(r,o){this.#e=r,this.#r=o,this.#e.onDidDispose(()=>this.dispose(),null)}#e;#r;static column=C.ViewColumn.Two;static openPanel(r,o,t,a,s){if(e.currentPanel){e.currentPanel.#e.reveal(e.column);return}let g=C.window.createWebviewPanel("liveHTMLPreview","liveHTMLPreview",e.column,{...G(r),...Y()});e.currentPanel=new e(g,r),e.closePreview=s;let U=C.Uri.joinPath(r,"panel-bar","address-bar.css"),W=C.Uri.joinPath(r,"panel-bar","address-bar.js"),S=g.webview.asWebviewUri(U),$=g.webview.asWebviewUri(W);g.webview.html=J($,S,o,a),e.console=new b,e.console.create("LPS Preview Console"),new M(g.webview,t,e.console)}dispose(){e.currentPanel=void 0,e.closePreview(),e.console.dispose(),this.#e.dispose()}};var re=h(require("vscode")),we={linux:"xdg-open",win32:"explorer",darwin:"open"},he={Brave:"start brave",Chrome:"start chrome",Chromium:"start chromium-browser",Edge:"start msedge",Firefox:"start firefox",Opera:"start opera",Vivaldi:"start vivaldi"},fe={Brave:"brave-browser",Chrome:"google-chrome",Chromium:"chromium-browser",Edge:"msedge",Firefox:"firefox",Opera:"opera",Vivaldi:"vivaldi"},ge={Brave:'open -a "Brave Browser"',Chrome:'open -a "Google Chrome" -g ',Chromium:"open -a chromium",Edge:'open -a  "Microsoft Edge"',Firefox:"open -a firefox -g ",Safari:'open -a "Brave Browser"',Opera:"open -a Opera",Vivaldi:"open -a vivaldi"},be={linux:fe,win32:he,darwin:ge};function Ce(e,r,o){if(o="http://localhost:"+o,e==="Default")return`${we[r]} ${o}`;let t=`${be[r][e]} ${o}`;return r==="linux"&&(t+=" & disown"),t}function H(e="default",r){let o=re.window.createTerminal("live preview server"),t=Ce(e,process.platform,r);o.sendText(t),setTimeout(()=>o.dispose(),2e3)}var k=require("vscode"),te=require("node:fs/promises"),D=require("node:path");async function oe(e){let r=await(0,te.readdir)(e,{withFileTypes:!0});for(let o of r)if(o.name.endsWith(".html")){let t=await k.workspace.openTextDocument((0,D.join)(e,o.name));return(await k.window.showTextDocument(t)).document}}async function se(){let e=k.window.activeTextEditor;if(e.document.languageId!=="html"){let r=(0,D.dirname)(e.document.fileName);try{return await oe(r)||await oe((0,D.dirname)(r))}catch(o){return console.error(o),null}}return e.document}var P=h(require("vscode"));var Pe=e=>({type:"chrome",request:"launch",name:"Debug localhost",url:e,webRoot:"${workspaceFolder}"});async function Be(e,r){let o=P.workspace.getConfiguration("launch",P.workspace.workspaceFolders[0].uri),t=o.get("configurations");t.findIndex(s=>s.url===r)===-1&&t.push(Pe(r)),o.update("configurations",t,P.ConfigurationTarget.WorkspaceFolder).then(()=>{})}async function ie(e,r,o){let t=`http://localhost:${r}${o}`;Be(e,t),P.commands.executeCommand("workbench.action.debug.start"),H("chrome",`${r}${o}`)}var v={InlinePreview:"livePreviewServer.start.inlinePreview",StartServer:"livePreviewServer.start.lpsServer",DebugServer:"livePreviewServer.start.debugServer",CloseServer:"livePreviewServer.close.server",PickBrowser:"livePreviewServer.start.PickBrowser"},p={Default:"livePreviewServer.start.defaultBrowser",Chrome:"livePreviewServer.start.chromeBrowser",Firefox:"livePreviewServer.start.firefoxBrowser",Brave:"livePreviewServer.start.braveBrowser",Safari:"livePreviewServer.start.safariBrowser",Chromium:"livePreviewServer.start.chromiumBrowser",Edge:"livePreviewServer.start.edgeBrowser",Vivaldi:"livePreviewServer.start.vivaldiBrowser",Opera:"livePreviewServer.start.operaBrowser"};var B=require("vscode");async function ne(){let e=x.quickPickBrowsers;if(typeof e!="object")return B.window.showErrorMessage("invalid browser list");let r=await B.window.showQuickPick(Object.keys(e));e[r]==="default"?p[r]?B.commands.executeCommand(p[r]):B.window.showErrorMessage("browser command not found"):e[r]&&B.window.createTerminal("live preview server").sendText(e[r])}var f=h(require("vscode"));var A=class{#e;constructor(){this.#e=f.window.createStatusBarItem(f.StatusBarAlignment.Right,2),this.setStartCommand()}setStartCommand(){this.#e.text="$(link-external) Browser",this.#e.color=new f.ThemeColor("sideBar.foreground"),this.#e.tooltip=this.#r(),this.#e.command=d.statusBarCommand||p.Default,this.#e.show()}#r(){let r=new f.MarkdownString(`Select browser<br>${this.getBrowserList()}`);return r.supportHtml=!0,r.isTrusted=!0,r}getBrowserList(){return d.toolTipBrowsers.map(o=>`&nbsp;&nbsp;&nbsp;&nbsp;[${o}](command:${p[o]||v.PickBrowser})`).join("<br>")}setCloseCommand(){this.#e.text="$(stop) Stop Server",this.#e.color="orange",this.#e.command=v.CloseServer,this.#e.tooltip="close live preview server"}hide(){this.#e.hide()}},T=new A;var R=i.workspace.workspaceFolders[0].uri.fsPath;async function Se(e){let r=d.serverPort||2200;var o;for(let n in p){let u=i.commands.registerCommand(p[n],async()=>{try{let c=await S();H(n,`${r}${c}`),T.setCloseCommand()}catch{}});e.subscriptions.push(u)}let t=i.commands.registerCommand(v.InlinePreview,async()=>{try{let n=await S();E.openPanel(e.extensionUri,n,R,r,q)}catch{}}),a=i.commands.registerCommand(v.StartServer,async()=>{try{await S(),j(),T.setCloseCommand()}catch{}}),s=i.commands.registerCommand(v.DebugServer,async()=>{try{let n=await S();await ie(R,r,n),T.setCloseCommand()}catch{}}),g=i.commands.registerCommand(v.PickBrowser,ne),U=i.commands.registerCommand(v.CloseServer,()=>{q(),T.setStartCommand()}),W=i.workspace.onDidChangeConfiguration(N);e.subscriptions.push(a),e.subscriptions.push(g),e.subscriptions.push(s),e.subscriptions.push(t),e.subscriptions.push(U),e.subscriptions.push(W);async function S(){let{PreviewServer:n}=require("../../preview-server/build/server.js"),u=new b,c=e.extensionPath;return o=new n(R,c,d,u,x),new Promise((y,w)=>{o.startServer(r).then($.bind(null,y)).catch(l);async function l(L){L==="EADDRINUSE"?await o.startServer(++r).then($.bind(null,y)).catch(l):(i.window.showErrorMessage("Cannot start server at port"+r),w())}})}async function $(n){let u;try{let c=await se();c&&c.languageId==="html"&&(d.liveRefresh&&o.parseLiveRefresher(c),u=c.fileName.slice(R.length))}catch{i.window.showErrorMessage("html file not found. Preview Server start without html file")}finally{j(),n(u)}}function j(n=!1){if(n){u?.dispose(),c?.dispose(),y?.dispose();return}var u=i.workspace.onDidSaveTextDocument(async w=>{o.reloadOnSave(w)}),c=i.window.onDidChangeActiveTextEditor(async w=>{if(!w)return;let l=w.document;d.liveRefresh&&(l.languageId==="html"||l.languageId==="css")&&o.parseLiveRefresher(l),o.changePageUrl(l)});if(e.subscriptions.push(u),e.subscriptions.push(c),d.liveRefresh){var y=i.workspace.onDidChangeTextDocument(w=>{let{document:l,contentChanges:L}=w;if(Array.isArray(L))for(let V of L)switch(l.languageId){case"html":o.updateElementAtPosition(V,l);break;case"css":o.updateRuleAtPosition(V,l);break}});e.subscriptions.push(y)}}function q(){j(!0),o?.closeServer()}}function xe(){previewServer?.closeServer()}0&&(module.exports={activate,deactivate});
